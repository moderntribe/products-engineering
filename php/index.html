---
layout: page
title: PHP
tags: php
---

<div id="page-index">
	<ol>
		<li>
			<a href="#php-basics">The basics</a>
		</li>
		<li>
			<a href="#php-codestyle">Code style</a>
			<ol>
				<li><a href="#php-overview">Overview</a></li>
				<li>
					<a href="#php-general">General</a>
					<ol>
						<li><a href="#php-general-files">Files</a></li>
						<li><a href="#php-general-keywords">Keywords and true/false/null</a></li>
					</ol>
				</li>
				<li><a href="#php-namespace">Namespace and use declarations</a></li>
				<li>
					<a href="#php-classes">Classes, properties, and methods</a>
					<ol>
						<li><a href="#php-classes-naming">Class naming</a></li>
						<li><a href="#php-classes-properites">Properties</a></li>
						<li><a href="#php-classes-constants">Constants</a></li>
						<li><a href="#php-classes-methods">Methods</a></li>
						<li><a href="#php-classes-method-args">Method arguments</a></li>
						<li><a href="#php-classes-abstract">Abstract, final, and static</a></li>
						<li><a href="#php-classes-calls">Method and function calls</a></li>
					</ol>
				</li>
				<li><a href="#php-functions">Functions</a></li>
				<li>
					<a href="#php-control">Control structures</a>
					<ol>
						<li><a href="#php-control-switch">Switch, case</a></li>
					</ol>
				</li>
				<li><a href="#php-closures">Closures</a></li>
			</ol>
		</li>
		<li>
			<a href="#php-wordpress">WordPress</a>
			<ol>
				<li><a href="#php-wordpress-hooks">Hooks & constants</a></li>
				<li><a href="#php-wordpress-deprecation">How to deprecate</a></li>
			</ol>
		</li>
	</ol>
</div>

## <a id="php-basics"></a> The Basics

First and foremost, we make an attempt to adhere to the [WordPress PHP coding standards](http://make.wordpress.org/core/handbook/coding-standards/php/). Additionally, we attempt to follow a number of [PSR-2 standards](http://www.php-fig.org/psr/psr-2/) where they don't conflict with WordPress.

## <a id="php-codestyle"></a> Code style

### <a id="php-overview"></a> Overview

* Visibility MUST be declared on all properties and methods; abstract and final MUST be declared before the visibility; static MUST be declared after the visibility.
* The soft limit on line length MUST be 120 characters; automated style checkers MUST warn but MUST NOT error at the soft limit.

### <a id="php-general"></a> General

#### <a id="php-general-files"></a> Files

* All PHP files MUST use the Unix LF (linefeed) line ending.
* The closing `?>` tag MUST be omitted from files containing only or ending in PHP.

#### <a id="php-general-keywords"></a> Keywords and true/false/null

* PHP keywords MUS be in lowercase.
* The PHP constants `true`, `false`, and `null` MUST be in lowercase.

### <a id="php-namespace"></a> Namespace and use declarations

Where we are able to use Namespaces (tests, SaaS code, etc), we should adhere to the [PSR-2 standards for Namespaces and Use Declarations](http://www.php-fig.org/psr/psr-2/#3-namespace-and-use-declarations).

### <a id="php-classes"></a>Classes, properties, and methods

When creating a new class, please try to ensure that the class has a single responsibility. Use inheritance when possible to keep things simple, organized and DRY.

#### <a id="php-classes-naming"></a>Class naming

Classes should be named with the Modern Tribe namespace ("Tribe"), the plugin namespace ("Events"), and then the classname. Those three parts should be separated by double underscores (which will translate to directory slashes in the autoloader). Since we're using double underscores as namespace separators, you can (and should) use single underscores in the class names. 

**Example: Naming a Class**

Wrong (not namespaced, uses CamelCase):

<pre>
class DateUtilities {
	// define some things
}
</pre>

Right:

Classes should be namespaced with a hierarchy that is separated by double-underscores (__). The hierarchy is as such: src/Tribe/Class_Name. In the class name, that translates to:

<pre>
class Tribe__Events__Date_Utilities {
	// define some things
}
</pre>

#### <a id="php-classes-properties"></a>Properties

We adhere to the [PSR-2 guidelines for properties](http://www.php-fig.org/psr/psr-2/#4-2-properties).

#### <a id="php-classes-constants"></a>Constants

Due to the difficulty of deprecating constants (`const`), we prefer the use of `public static` class properties. This way, if we wish to deprecate the property, we can communicate that deprecation via magic `__get()` methods.

<pre>
// bad
const BACON = 'yummy';

// preferred
public static $bacon = 'yummy';
</pre>

#### <a id="php-classes-methods"></a>Methods

* Visibility MUST be declared on all methods.
* Method names SHOULD NOT be prefixed with a single underscore to indicate protected or private visibility.
* Method names MUST NOT be declared with a space after the method name.
* For public methods that we want to deter public use, use the `@internal` docblock tag rather than an underscore prefix.
* The default visibility for class members should be `private`. Increase the visibility incrementally (to protected, and then public), as needed. 
* Static methods and properties should be used sparingly and avoided whenever possible.
* Be as DRY as possible.

#### <a id="php-classes-method-args"></a>Method arguments

Argument lists MAY be split across multiple lines, where each subsequent line is indented once. When doing so, the first item in the list MUST be on the next line, and there MUST be only one argument per line.

When the argument list is split across multiple lines, the closing parenthesis and opening brace MUST be placed together on their own line with one space between them.

Example:
<pre>
public function star_wars(
  $episode,
  $character,
  $species,
  $weapon
) {
  // do stuff
}
</pre>

#### <a id="php-classes-abstract"></a> Abstract, final, and static

We adhere to the [PSR-2 guidelines for abstract, final and static](http://www.php-fig.org/psr/psr-2/#4-5-abstract-final-and-static).

#### <a id="php-classes-calls"></a> Method and function calls

Argument lists MAY be split across multiple lines, where each subsequent line is indented once. When doing so, the first item in the list MUST be on the next line, and there MUST be only one argument per line.

Example:

<pre>
star_wars(
  'IV',
  'Greedo',
  'Rodian',
  'DT-12'
);
</pre>

### <a id="php-functions"></a> Functions

#### When to create global functions
If there is a piece of code that is frequently referenced throughout the addons, or could be useful to users who want to create custom templates or addons, that’s when it’s appropriate to create a global function. 

Keep in mind that whenever a global function is created and released, from that point on, it’ll be “in the wild”. Customers may be using it in their themes or plugins, and we will need to support it from that point on. With this in mind, please be sure not to create unnecessary functions that we won’t want to support.

#### Where to put function code
There are template tag files for most areas of the plugin. They are located in the `template-tags/` directory. Take care in selecting the appropriate file for your new function, and place the new function at the end of the file. If it closely references another function in the file, place it next to that function.

It’s usually appropriate to place the logic for a function into a class, and then use a function as a wrapper for the class method. When you have some code that you’d like to make publicly available, but it would also make sense as a method of one of our classes, you should make the method within the class, and then make a global function that calls that method and returns its result.

#### Echo or return?
When a function returns a scalar value that might be used in templates, be sure to return the value instead of echoing it. There is no need to take `$echo` as a boolean argument to the function; if a user wants to echo the value, they can simply directly echo the function’s result in their template.

#### Applying filters to the result
Note that whenever you create a global function, be sure to run `apply_filters()` on the result before it’s returned.

The filter should have the same name as the function, and should be passed the return value, followed by (at minimum), all parameters that were passed to the function initially.

#### Function naming
Since we’re creating code that is distributed, has been downloaded over 1 million times, and will be installed alongside myriad themes and plugins, it’s very important that you prefix your global namespace definitions with `tribe_` -- so there’s far less chance another plugin’s or theme’s definitions will have the same name.

**Example: Naming a Global Function**

Wrong (not namespaced, uses camelCase): 

<pre>
function getEventStartTime() {
	// do something
}
</pre>

Right (prefixed with `tribe_`, uses underscores):

<pre>
function tribe_get_event_start_time() {
	// do something
}
</pre>

### <a id="php-control"></a> Control structures

#### <a id="php-control-switch"></a>Switch, case

We adhere to the [PSR-2 guidelines for `switch` and `case` statements](http://www.php-fig.org/psr/psr-2/#5-2-switch-case) _except_ for the standards around spacing within parentheses.

### <a id="php-closures"></a> Closures

We adhere to the [PSR-2 guidelines for closuers](http://www.php-fig.org/psr/psr-2/#6-closures) _except_ for the standards around spacing within parentheses.

## <a id="php-wordpress"></a>WordPress

### <a id="php-wordpress-hooks"></a>Hooks vs constants

Occasionally we may have a request or an idea for a setting that could be useful to advanced users, but that isn’t something we’d want to expose to everyone in the plugin’s settings pages. In those cases, we’ll usually want to create a “hidden” setting that is available for users to set the value of via a hook or a constant.

#### When to Use a Hook
Most of the time hooks should be used to create these hidden settings. A user will then be able to create a line in their functions.php which sets the value.

#### When to Use a Constant
Constants should only be used when a site owner will want to set a setting site-wide, no matter what theme or plugins are in use, and no theme or plugin should be allowed to override this value. A user will then be able to create a line in their wp-config.php which sets the value. 

_**NOTE:** if a Modern Tribe developer would like to suggest a constant be used, they will need to bring it up during the code review that happens once per release cycle. Pull requests that add constants to the codebase will also need to be discussed on Modern Tribe's internal code review before they are accepted._

#### Hooking from Within Objects
Very often an object will need to add a number of actions and filters of its own. As a rule of thumb, any `add_action()` or `add_filter()` calls should be contained inside a `hook()` method and should **not** be setup from within the constructor.

### <a id="php-wordpress-deprecation"></a>How to deprecate

When a global function or hook needs to be renamed or taken out of use, please take the following steps:

* For functions, move the function to the `deprecated.php` file  
* Place an `@deprecated` phpDoc docblock tag in the documentation for the function or hook  
* Place an `@todo` in the phpDoc docblock that describes when to remove the function. It should be a minimum of two versions into the future.  
* For functions, run WordPress' `_deprecated_function()` just inside function  
* For hooks, check `has_filter()`, and if it returns true, run the WordPress `_deprecated_function()` just above the hook  

_**NOTE:** private and protected class members don’t need to be deprecated._

